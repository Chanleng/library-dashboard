<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Library Dashboard ‚Äî Starter</title>
<style>
  :root{
    --bg:#f7fafc; --card:#fff; --muted:#6b7280; --primary:#0ea5a4; --accent:#fb7185;
    --glass: rgba(255,255,255,0.6);
    --radius:12px; --shadow: 0 6px 18px rgba(13,20,30,0.06);
    --gap:16px; font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#0f172a;line-height:1.35;font-size:14px;padding:20px;}
  .app{display:flex;gap:var(--gap);min-height:80vh}

  /* Sidebar */
  .sidebar{
    width:260px;background:linear-gradient(180deg,#ffffff,#fbfdff);border-radius:14px;padding:18px;box-shadow:var(--shadow);flex:0 0 260px;
  }
  .brand{display:flex;gap:12px;align-items:center;margin-bottom:18px}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--primary),#4f46e5);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
  nav ul{list-style:none;padding:0;margin:6px 0}
  nav li{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;color:var(--muted);cursor:pointer}
  nav li:hover{background:#f1f5f9;color:#0f172a}
  .badge{background:#eef2ff;color:#3730a3;padding:4px 8px;border-radius:999px;font-size:12px;margin-left:auto}

  /* Main */
  .main{flex:1;display:flex;flex-direction:column;gap:var(--gap)}
  .topbar{display:flex;align-items:center;justify-content:space-between;padding:8px 12px}
  .search{display:flex;gap:8px;align-items:center;background:var(--card);padding:8px;border-radius:999px;box-shadow:var(--shadow);width:420px}
  .search input{border:0;background:transparent;outline:none;width:100%;padding:6px}
  .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:var(--gap)}
  .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:var(--shadow)}
  .card h3{margin:0;color:var(--muted);font-size:13px;font-weight:600}
  .card .value{font-size:20px;font-weight:700;margin-top:8px}

  /* table */
  .table-wrap{background:transparent;border-radius:12px;overflow:hidden}
  table{width:100%;border-collapse:collapse;background:var(--card);box-shadow:var(--shadow);border-radius:12px;overflow:hidden}
  thead tr{background:linear-gradient(90deg,#f8fafc,#ffffff)}
  th,td{padding:12px;text-align:left;border-bottom:1px solid #eef2f6;font-size:13px}
  th{color:var(--muted);font-weight:600}
  tr:last-child td{border-bottom:0}
  img.thumb{width:44px;height:44px;border-radius:6px;object-fit:cover}
  .chip{padding:6px 8px;border-radius:999px;font-size:12px;display:inline-block}
  .chip.available{background:#ecfeff;color:#065f46}
  .chip.borrowed{background:#fff7ed;color:#92400e}
  .chip.overdue{background:#fff1f2;color:#9f1239}

  /* actions */
  .actions button{margin-right:6px;padding:8px 10px;border-radius:8px;border:0;cursor:pointer}
  .btn-primary{background:var(--primary);color:white}
  .btn-muted{background:#f1f5f9;color:#0f172a}

  /* modal */
  .modal-backdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.4);z-index:40}
  .modal{width:720px;max-width:95%;background:var(--card);padding:16px;border-radius:12px;box-shadow:0 20px 60px rgba(2,6,23,0.35)}
  form .row{display:flex;gap:10px;margin-bottom:10px}
  form label{font-size:13px;color:var(--muted);min-width:110px;padding-top:6px}
  form input, form select, form textarea{flex:1;padding:10px;border-radius:8px;border:1px solid #e6eef6}
  .modal .footer{display:flex;justify-content:flex-end;gap:8px;margin-top:10px}

  /* responsiveness */
  @media (max-width:980px){
    .kpis{grid-template-columns:repeat(2,1fr)}
    .sidebar{display:none}
    body{padding:12px}
  }
  @media (max-width:640px){
    .kpis{grid-template-columns:1fr}
    .search{width:100%}
  }
</style>
</head>
<body>
<div class="app">
  <aside class="sidebar" aria-label="Main navigation">
    <div class="brand">
      <div class="logo">LM</div>
      <div>
        <div style="font-weight:700">Library Manager</div>
        <div style="font-size:12px;color:var(--muted)">Admin Dashboard</div>
      </div>
    </div>
    <nav>
      <ul>
        <li>üìä Dashboard <span class="badge">New</span></li>
        <li>üìö Books</li>
        <li>‚úçÔ∏è Authors</li>
        <li>üôç Members</li>
        <li>üì• Borrowings</li>
        <li>üìà Reports</li>
        <li>‚öôÔ∏è Settings</li>
      </ul>
    </nav>

    <div style="margin-top:12px;color:var(--muted);font-size:13px">
      Quick actions
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn-primary" onclick="openModal('createBook')">+ New Book</button>
        <button class="btn-muted" onclick="openModal('createMember')">+ Member</button>
      </div>
    </div>
  </aside>

  <main class="main" role="main">
    <div class="topbar">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="search" role="search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path stroke="#94a3b8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35"/><circle cx="11" cy="11" r="6" stroke="#94a3b8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <input id="globalSearch" placeholder="Search books, authors, members..." oninput="renderTable()" />
        </div>
      </div>

      <div style="display:flex;gap:12px;align-items:center">
        <button class="btn-muted" onclick="openModal('updateBorrow')">Update Borrowing</button>
        <div style="display:flex;gap:8px;align-items:center">
          <div title="Notifications">üîî</div>
          <div style="display:flex;align-items:center;gap:8px">
            <img src="https://via.placeholder.com/36" style="border-radius:999px" alt="avatar"/>
            <div style="font-size:13px">Admin</div>
          </div>
        </div>
      </div>
    </div>

    <section class="kpis" aria-label="Key stats">
      <div class="card">
        <h3>Total Books</h3>
        <div class="value" id="statBooks">‚Äî</div>
      </div>
      <div class="card">
        <h3>Total Members</h3>
        <div class="value" id="statMembers">‚Äî</div>
      </div>
      <div class="card">
        <h3>Books Borrowed</h3>
        <div class="value" id="statBorrowed">‚Äî</div>
      </div>
      <div class="card">
        <h3>Overdue</h3>
        <div class="value" id="statOverdue">‚Äî</div>
      </div>
    </section>

    <section style="margin-top:12px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h2 style="margin:0">Books</h2>
        <div>
          <button class="btn-muted" onclick="seedSample()">Seed sample</button>
          <button class="btn-primary" onclick="openModal('createBook')">+ Add Book</button>
        </div>
      </div>

      <div class="table-wrap">
        <table id="booksTable" role="table" aria-label="Books table">
          <thead>
            <tr>
              <th>Cover</th><th>Title</th><th>Author</th><th>Genre</th><th>ISBN</th><th>Status</th><th>Published</th><th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>
</div>

<!-- Modals -->
<div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-hidden="true">
  <div class="modal" role="document" aria-modal="true" id="modalContent">
    <!-- content is injected by JS -->
  </div>
</div>

<script>
/* In-memory data stores (demo) */
let books = [];
let authors = [];
let members = [];
let borrowings = []; // {id, bookId, memberId, borrowDate, dueDate, returnDate, status}

function uid(prefix='id'){return prefix + Math.random().toString(36).slice(2,9)}

/* helpers */
function formatDate(d){ if(!d) return ''; const dt = new Date(d); return dt.toLocaleDateString(); }
function getStatus(bookId){
  const b = borrowings.find(x=> x.bookId===bookId && x.status==='borrowed');
  if(!b) return 'available';
  const due = new Date(b.dueDate); if(new Date() > due) return 'overdue';
  return 'borrowed';
}

/* render KPIs */
function renderStats(){
  document.getElementById('statBooks').textContent = books.length;
  document.getElementById('statMembers').textContent = members.length;
  const borrowedCount = borrowings.filter(b => b.status === 'borrowed').length;
  document.getElementById('statBorrowed').textContent = borrowedCount;
  const overdueCount = borrowings.filter(b => b.status === 'borrowed' && new Date() > new Date(b.dueDate)).length;
  document.getElementById('statOverdue').textContent = overdueCount;
}

/* table render */
function renderTable(){
  const tbody = document.querySelector('#booksTable tbody');
  tbody.innerHTML = '';
  const q = (document.getElementById('globalSearch').value || '').toLowerCase();

  const filtered = books.filter(b => {
    const a = authors.find(x=>x.id===b.authorId) || {};
    return [b.title, b.isbn, (a.name||'') , b.genre].join(' ').toLowerCase().includes(q);
  });

  for(const b of filtered){
    const a = authors.find(x=>x.id===b.authorId) || {name:'‚Äî'};
    const status = getStatus(b.id);
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><img class="thumb" src="${b.cover || 'https://via.placeholder.com/80x100?text=Cover'}" alt="cover"></td>
      <td>${escapeHtml(b.title)}</td>
      <td>${escapeHtml(a.name)}</td>
      <td>${escapeHtml(b.genre)}</td>
      <td>${escapeHtml(b.isbn)}</td>
      <td><span class="chip ${status==='available'?'available':status==='borrowed'?'borrowed':'overdue'}">${status}</span></td>
      <td>${formatDate(b.published_at)}</td>
      <td class="actions">
        <button onclick="openModal('editBook','${b.id}')">Edit</button>
        <button onclick="removeBook('${b.id}')">Delete</button>
      </td>`;
    tbody.appendChild(tr);
  }
  renderStats();
}

/* modal management */
function openModal(type,id){
  const mb = document.getElementById('modalBackdrop');
  const mc = document.getElementById('modalContent');
  mb.style.display='flex'; mb.setAttribute('aria-hidden','false');
  if(type==='createBook'){
    mc.innerHTML = modalCreateBook();
  } else if(type==='createAuthor'){
    mc.innerHTML = modalCreateAuthor();
  } else if(type==='createMember'){
    mc.innerHTML = modalCreateMember();
  } else if(type==='editBook'){
    const book = books.find(x=>x.id===id);
    mc.innerHTML = modalEditBook(book);
  } else if(type==='updateBorrow'){
    mc.innerHTML = modalUpdateBorrow();
  }
}

document.getElementById('modalBackdrop').addEventListener('click', (e)=>{
  if(e.target.id==='modalBackdrop') closeModal();
});
function closeModal(){ document.getElementById('modalBackdrop').style.display='none'; document.getElementById('modalBackdrop').setAttribute('aria-hidden','true'); }

/* forms / actions (simple, in-memory) */
function modalCreateBook(){
  const authorOptions = authors.map(a=> `<option value="${a.id}">${escapeHtml(a.name)}</option>`).join('');
  return `
    <h3>Create Book</h3>
    <form onsubmit="event.preventDefault(); submitCreateBook(this)">
      <div class="row"><label>Title</label><input name="title" required /></div>
      <div class="row"><label>Author</label>
        <select name="authorId" required>
          <option value="">‚Äî select ‚Äî</option>
          ${authorOptions}
        </select>
        <button type="button" onclick="openModal('createAuthor')" style="margin-left:8px">+ Author</button>
      </div>
      <div class="row"><label>ISBN</label><input name="isbn" /></div>
      <div class="row"><label>Genre</label><input name="genre" /></div>
      <div class="row"><label>Published</label><input name="published_at" type="date" /></div>
      <div class="row"><label>Cover URL</label><input name="cover" placeholder="https://..." /></div>
      <div class="footer">
        <button type="button" class="btn-muted" onclick="closeModal()">Cancel</button>
        <button class="btn-primary" type="submit">Create</button>
      </div>
    </form>`;
}

function submitCreateBook(form){
  const data = new FormData(form);
  const book = {
    id: uid('book_'),
    title: data.get('title'),
    authorId: data.get('authorId'),
    isbn: data.get('isbn'),
    genre: data.get('genre'),
    published_at: data.get('published_at') || null,
    cover: data.get('cover') || null
  };
  books.push(book);
  closeModal();
  renderTable();
}

function modalCreateAuthor(){
  return `
    <h3>Create Author</h3>
    <form onsubmit="event.preventDefault(); submitCreateAuthor(this)">
      <div class="row"><label>Name</label><input name="name" required /></div>
      <div class="row"><label>Bio</label><textarea name="bio"></textarea></div>
      <div class="footer">
        <button type="button" class="btn-muted" onclick="closeModal()">Cancel</button>
        <button class="btn-primary" type="submit">Create</button>
      </div>
    </form>`;
}
function submitCreateAuthor(form){
  const data = new FormData(form);
  const auth = {id: uid('author_'), name: data.get('name'), bio: data.get('bio')};
  authors.push(auth);
  closeModal();
  renderTable();
}

function modalCreateMember(){
  return `
    <h3>Create Member</h3>
    <form onsubmit="event.preventDefault(); submitCreateMember(this)">
      <div class="row"><label>Full name</label><input name="name" required /></div>
      <div class="row"><label>Email</label><input name="email" type="email"/></div>
      <div class="row"><label>Phone</label><input name="phone"/></div>
      <div class="footer">
        <button type="button" class="btn-muted" onclick="closeModal()">Cancel</button>
        <button class="btn-primary" type="submit">Create</button>
      </div>
    </form>`;
}
function submitCreateMember(form){
  const data = new FormData(form);
  const m = {id: uid('member_'), name: data.get('name'), email: data.get('email'), phone: data.get('phone')};
  members.push(m);
  closeModal();
  renderTable();
}

function modalEditBook(book){
  const authorOptions = authors.map(a=> `<option value="${a.id}" ${a.id===book.authorId?'selected':''}>${escapeHtml(a.name)}</option>`).join('');
  return `
    <h3>Edit Book</h3>
    <form onsubmit="event.preventDefault(); submitEditBook(this,'${book.id}')">
      <div class="row"><label>Title</label><input name="title" value="${escapeAttr(book.title)}" required /></div>
      <div class="row"><label>Author</label>
        <select name="authorId" required>
          ${authorOptions}
        </select>
      </div>
      <div class="row"><label>ISBN</label><input name="isbn" value="${escapeAttr(book.isbn)}" /></div>
      <div class="row"><label>Genre</label><input name="genre" value="${escapeAttr(book.genre)}" /></div>
      <div class="row"><label>Published</label><input name="published_at" type="date" value="${book.published_at || ''}" /></div>
      <div class="row"><label>Cover URL</label><input name="cover" value="${escapeAttr(book.cover||'')}" /></div>
      <div class="footer">
        <button type="button" class="btn-muted" onclick="closeModal()">Cancel</button>
        <button class="btn-primary" type="submit">Save</button>
      </div>
    </form>`;
}
function submitEditBook(form,id){
  const data = new FormData(form); const book = books.find(b=>b.id===id);
  book.title = data.get('title'); book.authorId = data.get('authorId'); book.isbn = data.get('isbn');
  book.genre = data.get('genre'); book.published_at = data.get('published_at'); book.cover = data.get('cover');
  closeModal(); renderTable();
}

function removeBook(id){
  if(!confirm('Delete this book?')) return;
  books = books.filter(b=>b.id!==id);
  // also remove borrowings of that book
  borrowings = borrowings.filter(x=> x.bookId !== id);
  renderTable();
}

/* Borrowing modal */
function modalUpdateBorrow(){
  const memberOptions = members.map(m=> `<option value="${m.id}">${escapeHtml(m.name)}</option>`).join('');
  const bookOptions = books.map(b=> `<option value="${b.id}">${escapeHtml(b.title)}</option>`).join('');
  return `
    <h3>Update Borrowing</h3>
    <form onsubmit="event.preventDefault(); submitUpdateBorrow(this)">
      <div class="row"><label>Member</label><select name="memberId" required><option value="">‚Äî</option>${memberOptions}</select></div>
      <div class="row"><label>Book</label><select name="bookId" required><option value="">‚Äî</option>${bookOptions}</select></div>
      <div class="row"><label>Borrow date</label><input name="borrowDate" type="date" required/></div>
      <div class="row"><label>Due date</label><input name="dueDate" type="date" required/></div>
      <div class="row"><label>Return date</label><input name="returnDate" type="date" /></div>
      <div class="row"><label>Status</label>
        <select name="status"><option value="borrowed">borrowed</option><option value="returned">returned</option></select>
      </div>
      <div class="row"><label>Notes</label><textarea name="notes"></textarea></div>
      <div class="footer">
        <button type="button" class="btn-muted" onclick="closeModal()">Cancel</button>
        <button class="btn-primary" type="submit">Save</button>
      </div>
    </form>`;
}
function submitUpdateBorrow(form){
  const data = new FormData(form);
  const item = {
    id: uid('bor_'),
    memberId: data.get('memberId'),
    bookId: data.get('bookId'),
    borrowDate: data.get('borrowDate'),
    dueDate: data.get('dueDate'),
    returnDate: data.get('returnDate') || null,
    status: data.get('status'),
    notes: data.get('notes') || ''
  };
  // mark as borrowed or returned logically
  borrowings.push(item);
  closeModal(); renderTable();
}

/* small util: seed */
function seedSample(){
  authors = [
    {id:'author_1', name:'Agatha Christie', bio:''},
    {id:'author_2', name:'George Orwell', bio:''},
    {id:'author_3', name:'Haruki Murakami', bio:''},
  ];
  books = [
    {id:'book_1', title:'1984', authorId:'author_2', isbn:'9780451524935', genre:'Dystopian', published_at:'1949-06-08', cover:'https://covers.openlibrary.org/b/id/8231856-L.jpg'},
    {id:'book_2', title:'Kafka on the Shore', authorId:'author_3', isbn:'9780099458326', genre:'Fiction', published_at:'2002-09-12', cover:'https://via.placeholder.com/80x120?text=Kafka'},
    {id:'book_3', title:'Murder on the Orient Express', authorId:'author_1', isbn:'9780007527502', genre:'Crime', published_at:'1934-01-01', cover:'https://via.placeholder.com/80x120?text=Orient'},
  ];
  members = [
    {id:'member_1', name:'Sokha Kim', email:'sokha@example.com', phone:'012345678'},
    {id:'member_2', name:'Chanleng Im', email:'c.im@example.com', phone:'098765432'},
  ];
  borrowings = [
    {id:'bor_1', bookId:'book_1', memberId:'member_1', borrowDate:'2025-10-01', dueDate:'2025-10-15', returnDate:null, status:'borrowed', notes:''},
    {id:'bor_2', bookId:'book_3', memberId:'member_2', borrowDate:'2025-09-01', dueDate:'2025-09-15', returnDate:'2025-09-14', status:'returned', notes:''},
  ];
  renderTable();
}

/* simple escape helpers for safety */
function escapeHtml(str){ if(!str) return ''; return (''+str).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
function escapeAttr(str){ return escapeHtml(str).replaceAll('"','&quot;'); }

/* initial render */
renderTable();
</script>
</body>
</html>
